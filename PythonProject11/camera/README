1. Các thành phần chính
a. Thư viện sử dụng
OpenCV (cv2): Xử lý hình ảnh và video

MediaPipe: Nhận diện điểm khớp cơ thể (pose) và khuôn mặt (face mesh)

YOLO (Ultralytics): Phát hiện người trong khung hình

Các thư viện khác: NumPy, SciPy, scikit-learn, v.v. hỗ trợ tính toán và xử lý dữ liệu

b. Các lớp chính
KalmanFilter: Lọc Kalman để làm mịn vị trí các điểm khớp

PoseValidator: Kiểm tra tính hợp lệ của tư thế

HighAccuracyMultiPersonPoseAnalyzer: Lớp chính thực hiện phân tích tư thế

EnhancedPersonTracker: Theo dõi người qua các frame

PerformanceMonitor: Theo dõi hiệu suất hệ thống

2. Luồng hoạt động chính
a. Khởi tạo
Tải model YOLO và khởi tạo các đối tượng MediaPipe Pose và Face Mesh với cấu hình độ chính xác cao

Thiết lập các thông số như ngưỡng tin cậy, kích thước ảnh, v.v.

b. Xử lý mỗi frame
Tiền xử lý ảnh:

Chuyển đổi màu sắc và áp dụng các bộ lọc nâng cao (CLAHE, bilateral filter) để cải thiện chất lượng ảnh

Phát hiện người bằng YOLO:

Sử dụng YOLO để phát hiện người trong khung hình

Áp dụng multi-scale inference để tăng độ chính xác

Lọc kết quả bằng NMS (Non-Maximum Suppression)

Theo dõi người:

Sử dụng Hungarian algorithm để kết hợp phát hiện mới với các đối tượng đang theo dõi

Duy trì ID của từng người qua các frame

Phân tích tư thế:

Với mỗi người được phát hiện, cắt vùng ảnh chứa người đó

Sử dụng MediaPipe Pose để nhận diện các điểm khớp

Áp dụng bộ lọc Kalman để làm mịn vị trí các điểm khớp

Tính toán các góc khớp (khuỷu tay, vai, v.v.) và phân tích tư thế

Phân tích tư thế bắn súng:

Kiểm tra các đặc điểm như vị trí tay so với mắt, độ ổn định cơ thể

Đánh giá khả năng đang ở tư thế ngắm bắn

Hiển thị kết quả:

Vẽ khung bao, các điểm khớp và thông tin phân tích lên ảnh

Hiển thị thông số hiệu suất (FPS, thời gian xử lý)

3. Các tính năng nâng cao
a. Độ chính xác cao
Sử dụng model MediaPipe với độ phức tạp cao (model_complexity=2)

Các ngưỡng tin cậy được đặt cao (0.7 thay vì 0.3)

Tiền xử lý ảnh nâng cao để cải thiện chất lượng đầu vào

b. Ổn định theo thời gian
Bộ lọc Kalman làm mịn vị trí điểm khớp

Lưu lịch sử tư thế để kiểm tra tính nhất quán

Làm mịn góc khớp bằng bộ lọc Savitzky-Golay

c. Đa luồng
Sử dụng ThreadPoolExecutor để xử lý song song nhiều người

Tách biệt luồng phát hiện (YOLO) và luồng phân tích tư thế

d. Theo dõi đối tượng
Gán ID duy nhất cho mỗi người qua các frame

Xử lý trường hợp người ra/vào khung hình